<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App</title>
    <link rel="stylesheet" type="text/css" href="static\CSS\style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous">
</head>


<body>
    <header>
        <div class="container__menu">
            <div class="menu">
                <nav>
                    <ul>
                        <li><a href="#" id="selected">Inicio</a></li>
                        <li><a href="#">Servicios</a>
                            <ul>
                                <li><a href="{{ url_for('gestion_usuarios') }}">Gestión de usuarios</a></li>
                                <li><a href="{{ url_for('gestion_maquinas') }}">Gestión de máquinas</a></li>
                                <li><a href="#">Gestión de nómina</a></li>
                                <li><a href="#">Gestión de membresias</a></li>
                                <li><a href="#">Gestión de instructores</a></li>
                            </ul>
                        </li>
                        <li><a href="#">Nosotros</a></li>
                        <li><a href="#">Contactos</a></li>
                        <li class="admin"><h6>Admin</h6></li>
                        <li class="user"><img src="/static/img/ic_person.png" alt=""></li>
                        <li><a href="{{ url_for('login') }}"></a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    {% for message in messages%}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        {{message}}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <main id="tabla">
        <div class="content-container">
            <div class="col-md-5">
                <form method="post">
                    <h1>Búsqueda de Máquinas</h1>
                    <form method="POST" action="/lista_maquinas">
                        <label for="busqueda">Buscar por nombre:</label>
                        <input type="text" id="nombre" name="nombre" required>
                        <button type="submit">Buscar</button>
                    </form>
                    {% if resultados %}
                    {% for m in resultados %}
                    <h2>Resultados de la búsqueda:</h2>
                    <table class="table table-striped table-bordered bg-white centrar-tabla">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Estado</th>
                                <th>Registro</th>
                                <th>Disponibilidad</th>
                                <th>Historial</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            <tr>
                                <td>{{ m.1}}</td>
                                <td id="estado{{ m.0 }}">
                                    {% if m.2 == 1 %}
                                        BUEN ESTADO
                                    {% else %}
                                        MAL ESTADO
                                    {% endif %}
                                </td>
                                <td>{{ m.3}}</td>
                                <td id="disponible{{ m.0 }}">
                                    {% if m.4 == 1 %}
                                        Disponible
                                    {% else %}
                                        No disponible
                                    {% endif %}</td>
                                    <td>
                                        <a href="/historial/{{m.3}}" class="btn btn-primary">HISTORIAL</a>
                                    </td>
                                <td>
                                    <!-- Agregar un formulario para cada fila con el botón "CAMBIAR ESTADO" -->
                                    <form method="POST" action="/cambiar_estado_maquina">
                                        <input type="hidden" name="maquina_id" value="{{ m.0 }}">
                                        <td>
                                            <button type="submit" class="btn btn-danger">CAMBIAR ESTADO</button>
                                        </td>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <p>No se encontraron resultados.</p>
                            {% endif %}
                        </tbody>
                    </table>
                    <a href="{{ url_for('gestion_maquinas') }}" class="btn btn-primary btn-block">Volver</a>
                </form>
            </div>
        </div>
    </main>

</body>

</html>